<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manga List Terbaru</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            line-height: 1.5;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            /* padding: 10px; */
            margin: 0 auto;
        }

        header {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 40px;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .logo i {
            color: #ff6b6b;
            font-size: 1.1rem;
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .nav-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .subtitle {
            font-size: 0.75rem;
            color: #aaa;
            margin-top: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .loading, .error, .empty {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading i {
            font-size: 2rem;
            color: #ff6b6b;
            margin-bottom: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: #ff6b6b;
        }

        .empty i {
            font-size: 2.5rem;
            color: #666;
            margin-bottom: 15px;
        }

        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        @media (max-width: 900px) {
            .manga-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }
        }

        @media (max-width: 500px) {
            .manga-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .manga-thumbnail {
                height: 190px;
            }

            .manga-info {
                padding: 12px;
            }

            .manga-title {
                font-size: 0.95rem;
                height: 2.8em;
            }

            .manga-rating, .manga-type {
                font-size: 0.8rem;
                padding: 3px 8px;
            }

            .latest-chapter {
                font-size: 0.85rem;
            }
            
            .detail-actions {
                justify-content: center;
            }
            
            #library-add-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 360px) {
            .manga-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .manga-thumbnail {
                height: 170px;
            }

            .manga-title {
                font-size: 0.9rem;
            }
        }

        .manga-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .manga-card:hover, .manga-card:focus {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .manga-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            background-color: #2d3748;
        }

        .manga-info {
            padding: 12px;
        }

        .manga-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 8px;
            color: #fff;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 2.8em;
        }

        .manga-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .manga-rating {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 8px;
            font-weight: 600;
        }

        .manga-type {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 8px;
        }

        .latest-chapter {
            font-size: 0.85rem;
            color: #aaa;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        #detail-page {
            display: none;
        }

        .manga-detail {
            margin-top: 15px;
        }

        .detail-header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .detail-header {
                flex-direction: row;
            }
        }

        .detail-thumbnail {
            width: 100%;
            max-width: 200px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            align-self: center;
        }

        .detail-thumbnail img {
            width: 100%;
            height: auto;
            display: block;
        }

        .detail-info {
            flex: 1;
        }

        .detail-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 12px;
        }

        .detail-meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }

        .meta-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 6px;
        }

        .meta-label {
            font-size: 0.75rem;
            color: #aaa;
            margin-bottom: 3px;
        }

        .meta-value {
            font-weight: 600;
            color: #fff;
            font-size: 0.9rem;
        }

        .genres {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
        }

        .genre-tag {
            background: rgba(156, 39, 176, 0.2);
            color: #ce93d8;
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 16px;
        }
        
        .detail-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        #library-add-btn {
            background: rgba(156, 39, 176, 0.2);
            color: #ce93d8;
        }
        
        #library-add-btn.in-library {
            background: rgba(76, 175, 80, 0.2);
            color: #81c784;
        }
        
        #library-add-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .synopsis {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .synopsis h3 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .chapters-section {
            margin-top: 20px;
        }

        .chapters-section h3 {
            color: #fff;
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chapters-list {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            overflow: hidden;
            max-height: 500px;
            overflow-y: auto;
        }

        .chapter-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            cursor: pointer;
        }

        .chapter-item:last-child {
            border-bottom: none;
        }

        .chapter-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .chapter-title {
            font-weight: 500;
            color: #fff;
            font-size: 0.9rem;
        }

        .chapter-date {
            font-size: 0.8rem;
            color: #aaa;
            flex-shrink: 0;
            margin-left: 10px;
        }

        #reader-page {
            display: none;
        }

        .reader-container {
            max-width: 800px;
            margin: 0 auto;
            /* padding: 0 5px; */
        }

        .reader-header {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            top: 55px;
            z-index: 90;
        }

        .reader-title {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .reader-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            padding: 0 10px 0 10px;
        }

        .reader-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.85rem;
            flex: 1;
            justify-content: center;
            min-width: 0;
            max-width: 48%;
            min-height: 44px;
        }

        .reader-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .reader-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .reader-btn.primary {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .reader-btn.primary:hover:not(:disabled) {
            background: rgba(255, 107, 107, 0.3);
        }

        .chapter-images {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
            position: relative;
            overflow-x: hidden;
        }
        /*
        .chapter-images::before,
        .chapter-images::after {
            content: '';
            position: fixed;
            top: 0;
            width: 20px;
            height: 100vh;
            z-index: 100;
            pointer-events: none;
        }
        
        .chapter-images::before {
            left: 0;
            background: linear-gradient(to right, rgba(255,107,107,0.1), transparent);
        }
        
        .chapter-images::after {
            right: 0;
            background: linear-gradient(to left, rgba(255,107,107,0.1), transparent);
        }
        */

        .chapter-image-container {
            position: relative;
            width: 100%;
            min-height: 80px;
            background: linear-gradient(45deg, #2d3748, #4a5568);
            overflow: hidden;
        }

        .chapter-image {
            width: 100%;
            height: auto;
            display: block;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chapter-image.loaded {
            opacity: 1;
        }

        .image-number {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            z-index: 2;
            display: none;
        }

        .reader-progress {
            margin-top: 15px;
            text-align: center;
            color: #aaa;
            font-size: 0.8rem;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 8px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .pagination {
            display: flex !important;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            gap: 8px;
        }

        .pagination button {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            color: #e0e0e0;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.85rem;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-width: 0;
            max-width: 48%;
        }

        .pagination button:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 0.8rem;
            color: #aaa;
            flex-shrink: 0;
            padding: 0 10px;
            min-width: 80px;
            text-align: center;
        }

        #logo-text {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
            line-height: 1.2;
            max-height: 2.4em;
            font-weight: 700;
            color: #fff;
            text-overflow: ellipsis;
            word-break: break-word;
            hyphens: auto;
            height: auto;
            min-height: 20px;
        }

        @supports not (-webkit-line-clamp: 2) {
            #logo-text {
                max-height: 2.4em;
                overflow: hidden;
                position: relative;
            }

            #logo-text::after {
                content: '...';
                position: absolute;
                bottom: 0;
                right: 0;
                padding-left: 4px;
                background: linear-gradient(to right, transparent, #1a1a2e 30%);
            }
        }

        footer {
            text-align: center;
            padding: 15px;
            color: #777;
            font-size: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 15px;
        }

        @media (max-width: 500px) {
            .container {
                /* padding: 8px; */
            }

            header {
                padding: 6px 8px;
            }

            .logo {
                font-size: 1.1rem;
            }

            .logo i {
                font-size: 1rem;
            }

            .detail-title {
                font-size: 1.3rem;
            }

            .detail-meta-grid {
                grid-template-columns: 1fr;
            }

            .reader-controls {
                gap: 4px;
            }

            .reader-btn {
                padding: 10px 12px;
                font-size: 0.8rem;
                min-height: 40px;
            }

            .nav-buttons {
                gap: 4px;
            }

            .nav-btn {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 360px) {
            .reader-title {
                font-size: 0.9rem;
            }

            .pagination button {
                padding: 6px 8px;
                font-size: 0.75rem;
            }

            .page-info {
                font-size: 0.75rem;
                min-width: 60px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-15 {
            margin-top: 15px;
        }

        .chapters-list::-webkit-scrollbar {
            width: 6px;
        }

        .chapters-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .chapters-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .chapters-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            z-index: 1000;
            padding-top: 60px;
            animation: fadeIn 0.3s ease;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: #1a1a2e;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .modal-header h3 {
            color: #fff;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 70px);
        }

        .search-input-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 1rem;
        }

        #search-input {
            width: 100%;
            padding: 12px 45px 12px 40px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        #search-input:focus {
            outline: none;
            border-color: #ff6b6b;
            background: rgba(255, 255, 255, 0.1);
        }

        #search-input::placeholder {
            color: #777;
        }

        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .search-results {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .search-result-thumbnail {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-title {
            font-weight: 600;
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 5px;
        }

        .search-result-rating {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 600;
        }

        .search-result-type {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 6px;
        }

        .search-result-chapter {
            font-size: 0.8rem;
            color: #aaa;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        #search-loading,
        #search-error,
        #search-empty {
            padding: 20px;
            text-align: center;
        }

        #search-loading .fas,
        #search-error .fas,
        #search-empty .fas {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        @media (max-width: 500px) {
            .modal {
                padding-top: 50px;
            }

            .modal-content {
                width: 95%;
                max-height: 85vh;
            }

            .modal-body {
                max-height: calc(85vh - 70px);
            }

            .search-result-item {
                padding: 10px;
            }

            .search-result-thumbnail {
                width: 50px;
                height: 70px;
            }

            .search-result-title {
                font-size: 0.9rem;
            }

            .nav-btn .btn-text {
                display: none;
            }

            .nav-btn i {
                margin: 0;
            }
        }

        @media (max-width: 360px) {
            .search-result-thumbnail {
                width: 45px;
                height: 65px;
            }

            .modal-header {
                padding: 12px 15px;
            }

            .modal-body {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div>
                <div class="logo" id="logo-btn">
                    <i class="fas fa-book-open"></i>
                    <span id="logo-text">Manga List</span>
                </div>
                <div class="subtitle" id="subtitle">Daftar manga terbaru dari Komikcast</div>
            </div>
            <div class="nav-buttons">
                <button id="library-toggle-btn" class="nav-btn">
                    <i class="fas fa-bookmark"></i> <span class="btn-text">Library</span>
                </button>
                <button id="search-toggle-btn" class="nav-btn">
                    <i class="fas fa-search"></i> <span class="btn-text">Search</span>
                </button>
                <button id="back-btn" class="nav-btn hidden">
                    <i class="fas fa-arrow-left"></i> <span class="btn-text">Kembali</span>
                </button>
                <button id="reader-back-btn" class="nav-btn hidden">
                    <i class="fas fa-book"></i> <span class="btn-text">Detail</span>
                </button>
            </div>
        </div>
    </header>

    <div id="search-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> Search Manga</h3>
                <button id="close-search-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-input-container">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="Search manga by title or keywords..."
                        autocomplete="off"
                    >
                    <button id="clear-search-btn" class="clear-btn hidden">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="search-loading" class="loading hidden">
                    <i class="fas fa-spinner"></i>
                    <p>Searching...</p>
                </div>
                <div id="search-error" class="error hidden">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p id="search-error-message">Failed to search</p>
                </div>
                <div id="search-empty" class="empty hidden">
                    <i class="fas fa-search"></i>
                    <p>No manga found</p>
                </div>
                <div id="search-results" class="search-results"></div>

                <div id="search-pagination" class="pagination hidden">
                    <button id="search-prev-btn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-info">Page <span id="search-current-page">1</span></div>
                    <button id="search-next-btn">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="library-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bookmark"></i> My Library</h3>
                <button id="close-library-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="library-empty" class="empty hidden">
                    <i class="fas fa-book"></i>
                    <p>Your library is empty. Add manga from the detail page!</p>
                </div>
                <div id="library-loading" class="loading hidden">
                    <i class="fas fa-spinner"></i>
                    <p>Loading your library...</p>
                </div>
                <div id="library-content" class="search-results"></div>
                
                <div id="library-pagination" class="pagination hidden">
                    <button id="library-prev-btn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-info">Page <span id="library-current-page">1</span></div>
                    <button id="library-next-btn">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <main class="container" id="main-page">
        <div id="loading" class="loading">
            <i class="fas fa-spinner"></i>
            <p>Memuat manga terbaru...</p>
        </div>

        <div id="error" class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="error-message">Gagal memuat data manga.</p>
            <button id="retry-btn" class="retry-btn">
                Coba Lagi
            </button>
        </div>

        <div id="empty" class="empty">
            <i class="fas fa-book"></i>
            <p>Tidak ada manga yang ditemukan.</p>
        </div>

        <div id="manga-grid" class="manga-grid" style="margin: 0 10px 0 10px;"></div>

        <div id="pagination" class="pagination" style="display: none;">
            <button id="prev-btn" disabled>
                <i class="fas fa-chevron-left"></i> Sebelumnya
            </button>
            <div class="page-info">Halaman <span id="current-page">1</span></div>
            <button id="next-btn">
                Selanjutnya <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </main>

    <div class="container" id="detail-page">
        <div id="detail-loading" class="loading">
            <i class="fas fa-spinner"></i>
            <p>Memuat detail manga...</p>
        </div>

        <div id="detail-error" class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="detail-error-message">Gagal memuat detail manga.</p>
            <button id="detail-retry-btn" class="retry-btn">
                Coba Lagi
            </button>
        </div>

        <div id="detail-content" class="manga-detail" style="margin: 0 10px 0 10px;"></div>
    </div>

    <div class="container" id="reader-page">
        <div id="reader-loading" class="loading">
            <i class="fas fa-spinner"></i>
            <p>Memuat chapter...</p>
        </div>

        <div id="reader-error" class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="reader-error-message">Gagal memuat chapter.</p>
            <button id="reader-retry-btn" class="retry-btn">
                Coba Lagi
            </button>
        </div>

        <div id="reader-content" class="reader-container" style="display: none;">
            <h6 style="text-align: center;color: dimgrey;font-style: italic;">(*use button or swipe Left/Right to change chapter)</h6>
            <div class="reader-controls" style="margin-bottom: 15px;">
                <button id="prev-chapter-btn" class="reader-btn" disabled>
                    <i class="fas fa-chevron-left"></i> <span class="btn-text">Prev</span>
                </button>
                <button id="next-chapter-btn" class="reader-btn primary">
                    <span class="btn-text">Next</span> <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div id="chapter-images" class="chapter-images"></div>

            <div class="reader-controls mt-15">
                <button id="prev-chapter-btn-bottom" class="reader-btn" disabled>
                    <i class="fas fa-chevron-left"></i> <span class="btn-text">Prev</span>
                </button>
                <button id="next-chapter-btn-bottom" class="reader-btn primary">
                    <span class="btn-text">Next</span> <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="reader-progress" id="reader-progress-text">
                Memuat gambar...
            </div>
        </div>
    </div>

    <footer>
        <p style="margin-top: 5px; font-size: 0.7rem;">Â© 2025 Manga List Viewer</p>
    </footer>

    <script>
        const API_BASE = 'https://unofficial-komikcast-api.vercel.app';
        const LATEST_API = `${API_BASE}/komikcast/latest`;
        const SEARCH_API = `${API_BASE}/komikcast/search`;

        let currentView = 'list';
        let currentPage = 1;
        let currentMangaSlug = '';
        let currentChapterSlug = '';
        let currentMangaTitle = '';
        let currentChapterData = null;

        let searchQuery = '';
        let searchCurrentPage = 1;

        let imageObserver = null;
        let loadedImagesCount = 0;
        let totalImagesCount = 0;

        let isChangingChapter = false;
        let lastChapterChangeTime = 0;
        const CHAPTER_CHANGE_COOLDOWN = 500;

        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        const MIN_SWIPE_DISTANCE = 50;
        const MAX_VERTICAL_DEVIATION = 30;

        const mainPageEl = document.getElementById('main-page');
        const detailPageEl = document.getElementById('detail-page');
        const readerPageEl = document.getElementById('reader-page');

        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const emptyEl = document.getElementById('empty');
        const detailLoadingEl = document.getElementById('detail-loading');
        const detailErrorEl = document.getElementById('detail-error');
        const readerLoadingEl = document.getElementById('reader-loading');
        const readerErrorEl = document.getElementById('reader-error');
        const readerContentEl = document.getElementById('reader-content');

        const mangaGridEl = document.getElementById('manga-grid');
        const detailContentEl = document.getElementById('detail-content');
        const chapterImagesEl = document.getElementById('chapter-images');

        const backBtn = document.getElementById('back-btn');
        const readerBackBtn = document.getElementById('reader-back-btn');
        const logoBtn = document.getElementById('logo-btn');
        const logoTextEl = document.getElementById('logo-text');
        const subtitleEl = document.getElementById('subtitle');

        const paginationEl = document.getElementById('pagination');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const currentPageEl = document.getElementById('current-page');

        const prevChapterBtn = document.getElementById('prev-chapter-btn');
        const nextChapterBtn = document.getElementById('next-chapter-btn');
        const prevChapterBtnBottom = document.getElementById('prev-chapter-btn-bottom');
        const nextChapterBtnBottom = document.getElementById('next-chapter-btn-bottom');
        const readerProgressText = document.getElementById('reader-progress-text');

        const retryBtn = document.getElementById('retry-btn');
        const detailRetryBtn = document.getElementById('detail-retry-btn');
        const readerRetryBtn = document.getElementById('reader-retry-btn');

        const searchToggleBtn = document.getElementById('search-toggle-btn');
        const searchModal = document.getElementById('search-modal');
        const closeSearchBtn = document.getElementById('close-search-btn');
        const searchInput = document.getElementById('search-input');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const searchLoading = document.getElementById('search-loading');
        const searchError = document.getElementById('search-error');
        const searchEmpty = document.getElementById('search-empty');
        const searchResults = document.getElementById('search-results');
        const searchPagination = document.getElementById('search-pagination');
        const searchPrevBtn = document.getElementById('search-prev-btn');
        const searchNextBtn = document.getElementById('search-next-btn');
        const searchCurrentPageEl = document.getElementById('search-current-page');

        const style = document.createElement('style');
        style.textContent = `
            .retry-btn {
                margin-top: 15px;
                padding: 8px 20px;
                background: #ff6b6b;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 0.9rem;
            }
            
            .retry-btn:hover {
                background: #ff5252;
            }
        `;
        document.head.appendChild(style);

        function saveMangaListToStorage(page, mangaList, meta) {
            try {
                const cacheData = {
                    mangaList: mangaList,
                    meta: meta,
                    timestamp: Date.now(),
                    page: page
                };
                localStorage.setItem('mangaListCache', JSON.stringify(cacheData));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function getMangaListFromStorage() {
            try {
                const cached = localStorage.getItem('mangaListCache');
                if (!cached) return null;

                const data = JSON.parse(cached);
                if (Date.now() - data.timestamp > 10 * 60 * 1000) {
                    localStorage.removeItem('mangaListCache');
                    return null;
                }

                return data;
            } catch (error) {
                console.error('Error reading from localStorage:', error);
                return null;
            }
        }

        function saveMangaDetailToStorage(slug, mangaDetail) {
            try {
                const detailCache = {
                    data: mangaDetail,
                    timestamp: Date.now()
                };
                localStorage.setItem(`mangaDetail_${slug}`, JSON.stringify(detailCache));
            } catch (error) {
                console.error('Error saving manga detail to localStorage:', error);
            }
        }

        function getMangaDetailFromStorage(slug) {
            try {
                const cached = localStorage.getItem(`mangaDetail_${slug}`);
                if (!cached) return null;

                const data = JSON.parse(cached);
                if (Date.now() - data.timestamp > 30 * 60 * 1000) {
                    localStorage.removeItem(`mangaDetail_${slug}`);
                    return null;
                }

                return data.data;
            } catch (error) {
                console.error('Error reading manga detail from localStorage:', error);
                return null;
            }
        }
        
        const LIBRARY_KEY = 'manga_library';
        
        function saveMangaToLibrary(mangaData) {
            try {
                const library = getLibrary();
                const existingIndex = library.findIndex(item => item.slug === mangaData.slug);
                
                if (existingIndex === -1) {
                    library.push({
                        ...mangaData,
                        addedAt: Date.now(),
                        lastReadAt: null,
                        lastReadChapter: null
                    });
                } else {
                    library[existingIndex] = {
                        ...library[existingIndex],
                        ...mangaData,
                        addedAt: library[existingIndex].addedAt
                    };
                }
                
                localStorage.setItem(LIBRARY_KEY, JSON.stringify(library));
                return true;
            } catch (error) {
                console.error('Error saving to library:', error);
                return false;
            }
        }
        
        function removeMangaFromLibrary(slug) {
            try {
                const library = getLibrary();
                const newLibrary = library.filter(item => item.slug !== slug);
                localStorage.setItem(LIBRARY_KEY, JSON.stringify(newLibrary));
                return true;
            } catch (error) {
                console.error('Error removing from library:', error);
                return false;
            }
        }
        
        function getLibrary() {
            try {
                const library = localStorage.getItem(LIBRARY_KEY);
                return library ? JSON.parse(library) : [];
            } catch (error) {
                console.error('Error getting library:', error);
                return [];
            }
        }
        
        function isInLibrary(slug) {
            const library = getLibrary();
            return library.some(item => item.slug === slug);
        }
        
        function getMangaFromLibrary(slug) {
            const library = getLibrary();
            return library.find(item => item.slug === slug);
        }
        
        function updateLastRead(slug, chapterSlug, chapterTitle) {
            try {
                const library = getLibrary();
                const mangaIndex = library.findIndex(item => item.slug === slug);
                
                if (mangaIndex !== -1) {
                    library[mangaIndex].lastReadAt = Date.now();
                    library[mangaIndex].lastReadChapter = chapterSlug;
                    library[mangaIndex].lastReadChapterTitle = chapterTitle;
                    localStorage.setItem(LIBRARY_KEY, JSON.stringify(library));
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error updating last read:', error);
                return false;
            }
        }
        
        function renderLibrary(page = 1, itemsPerPage = 20) {
            const library = getLibrary();
            const libraryContent = document.getElementById('library-content');
            const libraryEmpty = document.getElementById('library-empty');
            const libraryPagination = document.getElementById('library-pagination');
            const libraryCurrentPageEl = document.getElementById('library-current-page');
            const libraryPrevBtn = document.getElementById('library-prev-btn');
            const libraryNextBtn = document.getElementById('library-next-btn');
            
            if (library.length === 0) {
                showElement(libraryEmpty);
                hideElement(libraryContent);
                hideElement(libraryPagination);
                return;
            }
            
            hideElement(libraryEmpty);
            showElement(libraryContent);
            
            const sortedLibrary = [...library].sort((a, b) => b.addedAt - a.addedAt);
            
            const totalPages = Math.ceil(sortedLibrary.length / itemsPerPage);
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageItems = sortedLibrary.slice(startIndex, endIndex);
            
            libraryContent.innerHTML = '';
            
            pageItems.forEach((manga, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item fade-in';
                resultItem.style.animationDelay = `${index * 0.05}s`;
                resultItem.dataset.slug = manga.slug;
                
                const thumbnail = manga.thumbnail || 'https://via.placeholder.com/60x80/2d3748/4a5568?text=No+Image';
                const addedDate = new Date(manga.addedAt).toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                
                let lastReadInfo = '';
                if (manga.lastReadChapterTitle) {
                    lastReadInfo = `
                        <div class="search-result-chapter">
                            <i class="fas fa-history"></i> Last read: ${manga.lastReadChapterTitle}
                        </div>
                    `;
                }
                
                resultItem.innerHTML = `
                    <img src="${thumbnail}" alt="${manga.title}" class="search-result-thumbnail" loading="lazy">
                    <div class="search-result-info">
                        <h4 class="search-result-title" title="${manga.title}">${manga.title}</h4>
                        <div class="search-result-meta">
                            <div class="search-result-rating">
                                <i class="fas fa-star"></i> ${manga.rating || 'N/A'}
                            </div>
                            <div class="search-result-type">${manga.type || 'Manga'}</div>
                        </div>
                        <div class="search-result-chapter">
                            <i class="fas fa-calendar-plus"></i> Added: ${addedDate}
                        </div>
                        ${lastReadInfo}
                    </div>
                    <button class="remove-from-library-btn nav-btn" data-slug="${manga.slug}" style="padding: 5px 8px; font-size: 0.7rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                resultItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.remove-from-library-btn')) {
                        hideLibraryModal();
                        showMangaDetail(manga.slug);
                    }
                });
                
                const removeBtn = resultItem.querySelector('.remove-from-library-btn');
                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const slug = removeBtn.dataset.slug;
                    removeMangaFromLibrary(slug);
                    renderLibrary(page, itemsPerPage);
                });
                
                libraryContent.appendChild(resultItem);
            });
            
            if (sortedLibrary.length > itemsPerPage) {
                libraryCurrentPageEl.textContent = page;
                libraryPrevBtn.disabled = page <= 1;
                libraryNextBtn.disabled = page >= totalPages;
                showElement(libraryPagination);
            } else {
                hideElement(libraryPagination);
            }
        }
        
        function showLibraryModal() {
            const libraryModal = document.getElementById('library-modal');
            libraryModal.classList.remove('hidden');
            renderLibrary();
        }
        
        function hideLibraryModal() {
            const libraryModal = document.getElementById('library-modal');
            libraryModal.classList.add('hidden');
        }

        function showElement(element) {
            element.style.display = 'block';
        }

        function hideElement(element) {
            element.style.display = 'none';
        }
        
        const libraryToggleBtn = document.getElementById('library-toggle-btn');
        if (libraryToggleBtn) {
            libraryToggleBtn.addEventListener('click', showLibraryModal);
        }
        
        const closeLibraryBtn = document.getElementById('close-library-btn');
        if (closeLibraryBtn) {
            closeLibraryBtn.addEventListener('click', hideLibraryModal);
        }
        
        const libraryModal = document.getElementById('library-modal');
        if (libraryModal) {
            libraryModal.addEventListener('click', (e) => {
                if (e.target === libraryModal) {
                    hideLibraryModal();
                }
            });
        }
        
        const libraryPrevBtn = document.getElementById('library-prev-btn');
        const libraryNextBtn = document.getElementById('library-next-btn');
        if (libraryPrevBtn && libraryNextBtn) {
            libraryPrevBtn.addEventListener('click', () => {
                const currentPage = parseInt(document.getElementById('library-current-page').textContent);
                if (currentPage > 1) {
                    renderLibrary(currentPage - 1);
                }
            });
            
            libraryNextBtn.addEventListener('click', () => {
                const currentPage = parseInt(document.getElementById('library-current-page').textContent);
                renderLibrary(currentPage + 1);
            });
        }
        
        document.addEventListener('click', (e) => {
            const libraryBtn = e.target.closest('#library-add-btn');
            if (libraryBtn) {
                const mangaSlug = currentMangaSlug;
                if (!mangaSlug || !currentMangaTitle) return;
                
                const thumbnailImg = document.querySelector('.detail-thumbnail img');
                const ratingElement = document.querySelector('.meta-value .fa-star')?.parentNode;
                const typeElement = document.querySelectorAll('.meta-value')[1];
                
                const mangaData = {
                    slug: mangaSlug,
                    title: currentMangaTitle,
                    thumbnail: thumbnailImg?.src || '',
                    rating: ratingElement?.textContent?.trim() || 'N/A',
                    type: typeElement?.textContent?.trim() || 'Manga'
                };
                
                const isCurrentlyInLibrary = isInLibrary(mangaSlug);
                
                if (isCurrentlyInLibrary) {
                    removeMangaFromLibrary(mangaSlug);
                    libraryBtn.innerHTML = '<i class="fas fa-bookmark"></i> Add to Library';
                    libraryBtn.classList.remove('in-library');
                } else {
                    saveMangaToLibrary(mangaData);
                    libraryBtn.innerHTML = '<i class="fas fa-bookmark"></i> In Library';
                    libraryBtn.classList.add('in-library');
                }
            }
        });

        function showListView() {
            currentView = 'list';
            mainPageEl.style.display = 'block';
            detailPageEl.style.display = 'none';
            readerPageEl.style.display = 'none';

            backBtn.classList.add('hidden');
            readerBackBtn.classList.add('hidden');

            logoTextEl.textContent = 'Manga List';
            subtitleEl.textContent = 'Daftar manga terbaru dari Komikcast';

            updateUrlHash('');
        }

        function showDetailView() {
            currentView = 'detail';
            mainPageEl.style.display = 'none';
            detailPageEl.style.display = 'block';
            readerPageEl.style.display = 'none';

            backBtn.classList.remove('hidden');
            readerBackBtn.classList.add('hidden');

            updateUrlHash(`manga/${currentMangaSlug}`);
        }

        function showReaderView() {
            currentView = 'reader';
            mainPageEl.style.display = 'none';
            detailPageEl.style.display = 'none';
            readerPageEl.style.display = 'block';

            backBtn.classList.add('hidden');
            readerBackBtn.classList.remove('hidden');

            updateUrlHash(`chapter/${currentChapterSlug}`);
        }

        function updateUrlHash(hash) {
            try {
                const newUrl = hash ? `#${hash}` : window.location.pathname;
                history.pushState({ hash: hash }, '', newUrl);
            } catch (error) {
                console.error('Error updating URL:', error);
            }
        }

        function showSearchModal() {
            searchModal.classList.remove('hidden');
            searchInput.focus();
        }

        function hideSearchModal() {
            searchModal.classList.add('hidden');
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            searchResults.innerHTML = '';
            searchPagination.classList.add('hidden');
            hideElement(searchError);
            hideElement(searchEmpty);
            searchQuery = '';
            searchCurrentPage = 1;
        }

        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            searchResults.innerHTML = '';
            searchPagination.classList.add('hidden');
            hideElement(searchError);
            hideElement(searchEmpty);
            searchQuery = '';
            searchCurrentPage = 1;
        }

        function initLazyLoading() {
            if (imageObserver) {
                imageObserver.disconnect();
            }

            loadedImagesCount = 0;

            imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        loadImage(img);
                        imageObserver.unobserve(img);
                    }
                });
            }, {
                rootMargin: '50px',
                threshold: 0.1
            });
        }

        function loadImage(img) {
            if (img.dataset.src) {
                const src = img.dataset.src;
                img.src = src;
                delete img.dataset.src;

                img.onload = () => handleImageLoad(img);
                img.onerror = () => handleImageError(img);
            }
        }

        function handleImageLoad(img) {
            loadedImagesCount++;
            updateProgress();

            img.classList.add('loaded');
        }

        function handleImageError(img) {
            loadedImagesCount++;
            updateProgress();

            img.style.filter = 'grayscale(100%)';
            img.style.opacity = '0.5';
            img.classList.add('loaded');
        }

        function updateProgress() {
            const progress = Math.round((loadedImagesCount / totalImagesCount) * 100);
            if (readerProgressText) {
                readerProgressText.textContent = `Memuat gambar (${loadedImagesCount}/${totalImagesCount})`;

                if (loadedImagesCount === totalImagesCount) {
                    readerProgressText.textContent = `Selesai memuat ${totalImagesCount} gambar`;
                }
            }
        }

        async function fetchWithTimeout(url, timeout = 15000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);

            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }

        async function fetchManga(page = 1, forceRefresh = false) {
            showElement(loadingEl);
            hideElement(errorEl);
            hideElement(emptyEl);
            hideElement(paginationEl);

            if (!forceRefresh) {
                const cachedData = getMangaListFromStorage();
                if (cachedData && cachedData.page === page) {
                    hideElement(loadingEl);
                    renderMangaList(cachedData.mangaList);
                    updatePagination(cachedData.meta);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }

            try {
                const url = page > 1 ? `${LATEST_API}?page=${page}` : LATEST_API;
                const response = await fetchWithTimeout(url);

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                hideElement(loadingEl);

                if (!data.data || data.data.length === 0) {
                    showElement(emptyEl);
                    return;
                }

                saveMangaListToStorage(page, data.data, data.meta);

                renderMangaList(data.data);
                updatePagination(data.meta);
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Error fetching manga:', error);
                hideElement(loadingEl);

                if (!forceRefresh) {
                    const cachedData = getMangaListFromStorage();
                    if (cachedData) {
                        renderMangaList(cachedData.mangaList);
                        updatePagination(cachedData.meta);
                        return;
                    }
                }

                if (document.getElementById('error-message')) {
                    document.getElementById('error-message').textContent = 
                        error.name === 'AbortError' 
                        ? 'Waktu permintaan habis. Periksa koneksi internet Anda.'
                        : `Gagal memuat data: ${error.message}`;
                }

                showElement(errorEl);
            }
        }

        async function searchManga(query, page = 1) {
            if (!query.trim()) {
                searchResults.innerHTML = '';
                searchPagination.classList.add('hidden');
                return;
            }

            searchQuery = query.trim();
            searchCurrentPage = page;

            showElement(searchLoading);
            hideElement(searchError);
            hideElement(searchEmpty);
            searchResults.innerHTML = '';
            searchPagination.classList.add('hidden');

            try {
                const url = `${SEARCH_API}?q=${encodeURIComponent(searchQuery)}&page=${page}`;
                const response = await fetchWithTimeout(url);

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                hideElement(searchLoading);

                if (!data.data || data.data.length === 0) {
                    showElement(searchEmpty);
                    return;
                }

                renderSearchResults(data.data);
                updateSearchPagination(data.meta);

            } catch (error) {
                console.error('Error searching manga:', error);
                hideElement(searchLoading);

                if (document.getElementById('search-error-message')) {
                    document.getElementById('search-error-message').textContent = 
                        error.name === 'AbortError' 
                        ? 'Request timeout. Check your internet connection.'
                        : `Failed to search: ${error.message}`;
                }

                showElement(searchError);
            }
        }

        function renderSearchResults(results) {
            if (!results || results.length === 0) {
                showElement(searchEmpty);
                return;
            }

            hideElement(searchEmpty);
            searchResults.innerHTML = '';

            results.forEach((manga, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item fade-in';
                resultItem.style.animationDelay = `${index * 0.05}s`;
                resultItem.dataset.slug = manga.slug;

                const thumbnail = manga.thumbnail || 'https://via.placeholder.com/60x80/2d3748/4a5568?text=No+Image';
                const latestChapterTitle = manga.latest_chapter?.title || 'Chapter tidak diketahui';

                resultItem.innerHTML = `
                    <img src="${thumbnail}" alt="${manga.title}" class="search-result-thumbnail" loading="lazy">
                    <div class="search-result-info">
                        <h4 class="search-result-title" title="${manga.title}">${manga.title}</h4>
                        <div class="search-result-meta">
                            <div class="search-result-rating">
                                <i class="fas fa-star"></i> ${manga.rating || 'N/A'}
                            </div>
                            <div class="search-result-type">${manga.type || 'Manga'}</div>
                        </div>
                        <div class="search-result-chapter" title="${latestChapterTitle}">
                            ${latestChapterTitle}
                        </div>
                    </div>
                `;

                resultItem.addEventListener('click', () => {
                    hideSearchModal();
                    showMangaDetail(manga.slug);
                });

                searchResults.appendChild(resultItem);
            });
        }

        function updateSearchPagination(meta) {
            if (!meta || !searchPagination) {
                if (searchPagination) searchPagination.classList.add('hidden');
                return;
            }

            searchCurrentPage = meta.page || 1;

            if (searchCurrentPageEl) searchCurrentPageEl.textContent = searchCurrentPage;

            if (searchPrevBtn) {
                searchPrevBtn.disabled = !meta.pagination?.previous_page;
            }

            if (searchNextBtn) {
                searchNextBtn.disabled = !meta.pagination?.next_page;
            }

            searchPagination.classList.remove('hidden');
        }

        async function fetchMangaDetail(slug, forceRefresh = false) {
            showElement(detailLoadingEl);
            hideElement(detailErrorEl);
            if (detailContentEl) detailContentEl.innerHTML = '';

            currentMangaSlug = slug;
            logoTextEl.textContent = 'Loading...';
            subtitleEl.textContent = 'Mengambil detail manga';

            if (!forceRefresh) {
                const cachedData = getMangaDetailFromStorage(slug);
                if (cachedData) {
                    hideElement(detailLoadingEl);
                    renderMangaDetail(cachedData);
                    currentMangaTitle = cachedData.title || 'Unknown Manga';

                    logoTextEl.textContent = cachedData.title || 'Detail Manga';
                    subtitleEl.textContent = '';

                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }

            try {
                const url = `${API_BASE}/komikcast/detail/${slug}`;
                const response = await fetchWithTimeout(url);

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                hideElement(detailLoadingEl);

                saveMangaDetailToStorage(slug, data.data);

                renderMangaDetail(data.data);
                currentMangaTitle = data.data.title || 'Unknown Manga';

                logoTextEl.textContent = data.data.title || 'Detail Manga';
                subtitleEl.textContent = '';

                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Error fetching manga detail:', error);
                hideElement(detailLoadingEl);

                if (!forceRefresh) {
                    const cachedData = getMangaDetailFromStorage(slug);
                    if (cachedData) {
                        renderMangaDetail(cachedData);
                        currentMangaTitle = cachedData.title || 'Unknown Manga';

                        logoTextEl.textContent = cachedData.title || 'Detail Manga';
                        subtitleEl.textContent = '';
                        return;
                    }
                }

                if (document.getElementById('detail-error-message')) {
                    document.getElementById('detail-error-message').textContent = 
                        error.name === 'AbortError' 
                        ? 'Waktu permintaan habis. Periksa koneksi internet Anda.'
                        : `Gagal memuat detail manga: ${error.message}`;
                }

                showElement(detailErrorEl);
                logoTextEl.textContent = 'Error';
                subtitleEl.textContent = 'Gagal memuat detail manga';
            }
        }

        async function fetchChapterImages(slug) {
            showElement(readerLoadingEl);
            hideElement(readerErrorEl);
            hideElement(readerContentEl);
            if (chapterImagesEl) chapterImagesEl.innerHTML = '';

            currentChapterSlug = slug;

            if (readerProgressText) {
                readerProgressText.textContent = 'Memuat gambar...';
            }

            try {
                const url = `${API_BASE}/komikcast/chapter/${slug}`;
                const response = await fetchWithTimeout(url);

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                currentChapterData = data.data;

                hideElement(readerLoadingEl);
                showElement(readerContentEl);

                renderChapterImages(data.data);
                updateChapterNavigation(data.data);

                logoTextEl.textContent = currentMangaTitle || 'Manga Reader';
                subtitleEl.textContent = 'Chapter '+data.data.chapter_number || 'Membaca chapter';

                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Error fetching chapter:', error);
                hideElement(readerLoadingEl);

                if (document.getElementById('reader-error-message')) {
                    document.getElementById('reader-error-message').textContent = 
                        error.name === 'AbortError' 
                        ? 'Waktu permintaan habis. Periksa koneksi internet Anda.'
                        : `Gagal memuat chapter: ${error.message}`;
                }

                showElement(readerErrorEl);
                logoTextEl.textContent = 'Error';
                subtitleEl.textContent = 'Gagal memuat chapter';
            }
        }

        function renderMangaList(mangaList) {
            if (!mangaGridEl) return;

            mangaGridEl.innerHTML = '';

            if (!mangaList || mangaList.length === 0) {
                showElement(emptyEl);
                return;
            }

            hideElement(emptyEl);

            mangaList.forEach((manga, index) => {
                const card = document.createElement('div');
                card.className = 'manga-card fade-in';
                card.style.animationDelay = `${index * 0.05}s`;
                card.dataset.slug = manga.slug;

                const thumbnail = manga.thumbnail || 'https://via.placeholder.com/150x200/2d3748/4a5568?text=No+Image';

                card.innerHTML = `
                    <img src="${thumbnail}" alt="${manga.title}" class="manga-thumbnail" loading="lazy">
                    <div class="manga-info">
                        <h3 class="manga-title" title="${manga.title}">${manga.title}</h3>
                        <div class="manga-meta">
                            <div class="manga-type">${manga.type || 'Manga'}</div>
                        </div>
                        <div class="latest-chapter" title="${manga.latest_chapter?.title || 'Tidak diketahui'}">
                            ${manga.latest_chapter?.title || 'Tidak diketahui'}
                        </div>
                    </div>
                `;

                card.addEventListener('click', () => {
                    showMangaDetail(manga.slug);
                });

                mangaGridEl.appendChild(card);
            });
        }

        function renderMangaDetail(manga) {
            if (!detailContentEl || !manga) return;
        
            const thumbnail = manga.thumbnail || 'https://via.placeholder.com/250x350/2d3748/4a5568?text=No+Image';
            const rating = manga.rating || 'N/A';
            currentMangaTitle = manga.title || 'Unknown Manga';
        
            let genresHtml = '';
            if (manga.genres && manga.genres.length > 0) {
                genresHtml = manga.genres.map(genre => 
                    `<span class="genre-tag">${genre}</span>`
                ).join('');
            } else {
                genresHtml = '<span class="genre-tag">Tidak ada genre</span>';
            }
        
            let chaptersHtml = '';
            if (manga.chapters && manga.chapters.length > 0) {
                const sortedChapters = [...manga.chapters].sort((a, b) => {
                    const getChapterNumber = (title) => {
                        if (!title) return 0;
                        const match = title.match(/(\d+(\.\d+)?)/);
                        return match ? parseFloat(match[1]) : 0;
                    };
        
                    const numA = getChapterNumber(a.title);
                    const numB = getChapterNumber(b.title);
        
                    return numB - numA;
                });
        
                chaptersHtml = sortedChapters.map(chapter => {
                    const date = chapter.released_at ? 
                        new Date(chapter.released_at).toLocaleDateString('id-ID', {
                            day: 'numeric',
                            month: 'short',
                            year: 'numeric'
                        }) : 'Tanggal tidak diketahui';
        
                    return `
                        <div class="chapter-item" data-slug="${chapter.slug}">
                            <div class="chapter-title">${chapter.title || 'Chapter tanpa judul'}</div>
                            <div class="chapter-date">${date}</div>
                        </div>
                    `;
                }).join('');
            } else {
                chaptersHtml = `
                    <div class="chapter-item">
                        <div class="chapter-title">Tidak ada chapter tersedia</div>
                    </div>
                `;
            }

            const isMangaInLibrary = isInLibrary(manga.slug);
            const libraryButtonText = isMangaInLibrary ? 'In Library' : 'Add to Library';
            const libraryButtonClass = isMangaInLibrary ? 'in-library' : '';
        
            detailContentEl.innerHTML = `
                <div class="manga-detail">
                    <div class="detail-header fade-in">
                        <div class="detail-thumbnail">
                            <img src="${thumbnail}" alt="${manga.title}" loading="lazy">
                        </div>
                        <div class="detail-info">
                            <h1 class="detail-title">${manga.title}</h1>
                            <div class="detail-meta-grid">
                                <div class="meta-item">
                                    <div class="meta-label">Rating</div>
                                    <div class="meta-value">
                                        <i class="fas fa-star" style="color: #ffc107;"></i> ${rating}
                                    </div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Tipe</div>
                                    <div class="meta-value">${manga.type || 'Tidak diketahui'}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Status</div>
                                    <div class="meta-value">${manga.status || 'Tidak diketahui'}</div>
                                </div>
                            </div>
                            <div class="genres">
                                ${genresHtml}
                            </div>
                            <div class="detail-actions">
                                <button id="library-add-btn" class="reader-btn ${libraryButtonClass}" style="margin-top: 10px;">
                                    <i class="fas fa-bookmark"></i> ${libraryButtonText}
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="synopsis fade-in" style="animation-delay: 0.1s">
                        <h3><i class="fas fa-align-left"></i> Sinopsis</h3>
                        <p>${manga.synopsis || 'Tidak ada sinopsis tersedia.'}</p>
                    </div>
                    
                    <div class="chapters-section fade-in" style="animation-delay: 0.2s">
                        <h3><i class="fas fa-list"></i> Daftar Chapter (${manga.chapters ? manga.chapters.length : 0})</h3>
                        <div class="chapters-list">
                            ${chaptersHtml}
                        </div>
                    </div>
                </div>
            `;
        
            const chapterItems = detailContentEl.querySelectorAll('.chapter-item[data-slug]');
            chapterItems.forEach(item => {
                item.addEventListener('click', () => {
                    const chapterSlug = item.dataset.slug;
                    showChapter(chapterSlug);
                });
            });
        }

        function renderChapterImages(chapterData) {
            if (!chapterImagesEl) return;

            chapterImagesEl.innerHTML = '';

            if (!chapterData.images || chapterData.images.length === 0) {
                chapterImagesEl.innerHTML = `
                    <div class="text-center fade-in">
                        <p style="color: #aaa; padding: 40px 20px;">
                            <i class="fas fa-image" style="font-size: 2.5rem; margin-bottom: 15px; display: block;"></i>
                            Tidak ada gambar yang tersedia untuk chapter ini.
                        </p>
                    </div>
                `;
                if (readerProgressText) {
                    readerProgressText.textContent = 'Tidak ada gambar';
                }
                return;
            }

            totalImagesCount = chapterData.images.length;
            loadedImagesCount = 0;

            if (readerProgressText) {
                readerProgressText.textContent = `Memuat gambar (0/${totalImagesCount})`;
            }
            initLazyLoading();

            chapterData.images.forEach((imageUrl, index) => {
                const imageNumber = index + 1;
                const container = document.createElement('div');
                container.className = 'chapter-image-container fade-in';
                container.style.animationDelay = `${index * 0.05}s`;

                container.innerHTML = `
                    <img 
                        data-src="${imageUrl}" 
                        alt="Page ${imageNumber}" 
                        class="chapter-image"
                    >
                    <div class="image-number">${imageNumber}/${totalImagesCount}</div>
                `;

                chapterImagesEl.appendChild(container);

                const img = container.querySelector('img');
                if (img && imageObserver) {
                    imageObserver.observe(img);
                }
            });

            const firstImages = chapterImagesEl.querySelectorAll('img');
            for (let i = 0; i < Math.min(2, firstImages.length); i++) {
                loadImage(firstImages[i]);
            }
        }

        function updateChapterNavigation(chapterData) {
            const hasPrevChapter = chapterData.previous_chapter_slug && chapterData.previous_chapter_slug !== '';
            const hasNextChapter = chapterData.next_chapter_slug && chapterData.next_chapter_slug !== '';

            if (prevChapterBtn) prevChapterBtn.disabled = !hasPrevChapter;
            if (prevChapterBtnBottom) prevChapterBtnBottom.disabled = !hasPrevChapter;
            if (nextChapterBtn) nextChapterBtn.disabled = !hasNextChapter;
            if (nextChapterBtnBottom) nextChapterBtnBottom.disabled = !hasNextChapter;
        }

        function goToNextChapter() {
            const now = Date.now();
            if (!isChangingChapter && now - lastChapterChangeTime > CHAPTER_CHANGE_COOLDOWN) {
                isChangingChapter = true;
                lastChapterChangeTime = now;
                if (currentChapterData && currentChapterData.next_chapter_slug) {
                    showChapter(currentChapterData.next_chapter_slug);
                }
                setTimeout(() => {
                    isChangingChapter = false;
                }, CHAPTER_CHANGE_COOLDOWN);
            }
        }

        function goToPrevChapter() {
            const now = Date.now();
            if (!isChangingChapter && now - lastChapterChangeTime > CHAPTER_CHANGE_COOLDOWN) {
                isChangingChapter = true;
                lastChapterChangeTime = now;
                if (currentChapterData && currentChapterData.previous_chapter_slug) {
                    showChapter(currentChapterData.previous_chapter_slug);
                }
                setTimeout(() => {
                    isChangingChapter = false;
                }, CHAPTER_CHANGE_COOLDOWN);
            }
        }

        function showChapter(chapterSlug) {
            currentChapterSlug = chapterSlug;
            showReaderView();
            fetchChapterImages(chapterSlug);
            
            if (currentMangaSlug) {
                updateLastRead(currentMangaSlug, chapterSlug, currentChapterData?.title || '');
            }
        }

        function showMangaDetail(slug) {
            currentMangaSlug = slug;
            showDetailView();
            fetchMangaDetail(slug);
        }

        function updatePagination(meta) {
            if (!meta || !paginationEl) {
                if (paginationEl) hideElement(paginationEl);
                return;
            }

            currentPage = meta.page || 1;
            if (currentPageEl) currentPageEl.textContent = currentPage;

            if (prevBtn) prevBtn.disabled = !meta.prev_page;
            if (nextBtn) nextBtn.disabled = !meta.next_page;

            showElement(paginationEl);
        }

        function parseHashRoute() {
            const hash = window.location.hash;

            if (!hash) {
                showListView();
                const cachedData = getMangaListFromStorage();
                if (cachedData && cachedData.mangaList) {
                    renderMangaList(cachedData.mangaList);
                    updatePagination(cachedData.meta);
                } else {
                    fetchManga();
                }
                return;
            }

            const parts = hash.substring(1).split('/');

            if (parts.length < 2) {
                showListView();
                fetchManga();
                return;
            }

            const type = parts[0];
            const slug = parts[1];

            if (type === 'manga') {
                currentMangaSlug = slug;
                showDetailView();
                fetchMangaDetail(slug);
            } else if (type === 'chapter') {
                currentChapterSlug = slug;
                showReaderView();
                fetchChapterImages(slug);
            } else {
                showListView();
                fetchManga();
            }
        }

        if (searchToggleBtn) {
            searchToggleBtn.addEventListener('click', showSearchModal);
        }

        if (closeSearchBtn) {
            closeSearchBtn.addEventListener('click', hideSearchModal);
        }

        if (clearSearchBtn) {
            clearSearchBtn.addEventListener('click', clearSearch);
        }

        searchModal.addEventListener('click', (e) => {
            if (e.target === searchModal) {
                hideSearchModal();
            }
        });

        if (searchInput) {
            let searchTimeout;

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value;

                if (query.trim()) {
                    clearSearchBtn.classList.remove('hidden');
                } else {
                    clearSearchBtn.classList.add('hidden');
                }

                clearTimeout(searchTimeout);

                if (query.trim()) {
                    searchTimeout = setTimeout(() => {
                        searchManga(query, 1);
                    }, 500);
                } else {
                    searchResults.innerHTML = '';
                    searchPagination.classList.add('hidden');
                    hideElement(searchError);
                    hideElement(searchEmpty);
                }
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = searchInput.value.trim();
                    if (query) {
                        searchManga(query, 1);
                    }
                }
            });
        }

        if (searchPrevBtn) {
            searchPrevBtn.addEventListener('click', () => {
                if (searchCurrentPage > 1) {
                    searchManga(searchQuery, searchCurrentPage - 1);
                }
            });
        }

        if (searchNextBtn) {
            searchNextBtn.addEventListener('click', () => {
                searchManga(searchQuery, searchCurrentPage + 1);
            });
        }

        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    fetchManga(currentPage - 1);
                }
            });
        }

        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                fetchManga(currentPage + 1);
            });
        }

        if (retryBtn) {
            retryBtn.addEventListener('click', () => {
                fetchManga(currentPage, true);
            });
        }

        if (detailRetryBtn) {
            detailRetryBtn.addEventListener('click', () => {
                if (currentMangaSlug) {
                    fetchMangaDetail(currentMangaSlug, true);
                }
            });
        }

        if (readerRetryBtn) {
            readerRetryBtn.addEventListener('click', () => {
                if (currentChapterSlug) {
                    fetchChapterImages(currentChapterSlug);
                }
            });
        }

        if (backBtn) {
            backBtn.addEventListener('click', () => {
                showListView();
            });
        }

        if (readerBackBtn) {
            readerBackBtn.addEventListener('click', () => {
                if (currentMangaSlug) {
                    showDetailView();
                    fetchMangaDetail(currentMangaSlug);
                } else {
                    showListView();
                }
            });
        }

        if (logoBtn) {
            logoBtn.addEventListener('click', () => {
                showListView();
            });
        }

        if (prevChapterBtn) {
            prevChapterBtn.addEventListener('click', goToPrevChapter);
        }

        if (nextChapterBtn) {
            nextChapterBtn.addEventListener('click', goToNextChapter);
        }

        if (prevChapterBtnBottom) {
            prevChapterBtnBottom.addEventListener('click', goToPrevChapter);
        }

        if (nextChapterBtnBottom) {
            nextChapterBtnBottom.addEventListener('click', goToNextChapter);
        }

        window.addEventListener('popstate', (event) => {
            parseHashRoute();
        });

        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                showLibraryModal();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                showSearchModal();
            } else if (e.key === 'Escape' && !searchModal.classList.contains('hidden')) {
                hideSearchModal();
            } else if (currentView === 'reader') {
                if (e.key === 'ArrowLeft' && prevChapterBtn && !prevChapterBtn.disabled) {
                    goToPrevChapter();
                } else if (e.key === 'ArrowRight' && nextChapterBtn && !nextChapterBtn.disabled) {
                    goToNextChapter();
                } else if (e.key === 'Escape') {
                    if (currentMangaSlug) {
                        showDetailView();
                        fetchMangaDetail(currentMangaSlug);
                    }
                }
            }
        });

        document.addEventListener('touchstart', (e) => {
            if (currentView === 'reader') {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            }
        }, { passive: true });

        document.addEventListener('touchend', (e) => {
            if (currentView === 'reader') {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;

                const diffX = touchStartX - touchEndX;
                const diffY = touchStartY - touchEndY;
                const absDiffX = Math.abs(diffX);
                const absDiffY = Math.abs(diffY);

                if (absDiffX > MIN_SWIPE_DISTANCE && absDiffX > absDiffY && absDiffY < MAX_VERTICAL_DEVIATION) {
                    const swipeThreshold = 50;
                    e.preventDefault();

                    if (diffX > swipeThreshold && nextChapterBtn && !nextChapterBtn.disabled) {
                        goToNextChapter();
                    } else if (diffX < -swipeThreshold && prevChapterBtn && !prevChapterBtn.disabled) {
                        goToPrevChapter();
                    }
                }
            }
        }, { passive: false });

        document.addEventListener('DOMContentLoaded', () => {
            const cachedData = getMangaListFromStorage();
            if (cachedData && cachedData.mangaList) {
                renderMangaList(cachedData.mangaList);
                updatePagination(cachedData.meta);
            }

            parseHashRoute();
        });

        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && currentView === 'list') {
                const cachedData = getMangaListFromStorage();
                if (cachedData && cachedData.mangaList) {
                    renderMangaList(cachedData.mangaList);
                    updatePagination(cachedData.meta);
                }
            }
        });
    </script>
</body>
</html>